# Module 4: databases

## This module demonstrates database modelling for the univercity

## Design

Let's design the simple database with 3 tables: students, subjects and exam_results. Students and Subjects tables both has id as the primary key which is foreign key in Exam results table and demonstrates one-to-many relationship, so each result can be identified by participating of single student in single subject. 

![alt text](design.png)

Let's create physical model of the database in postgress. SQL for tables creation can be checked in [create_db.sql](create_db.sql). There were added some constraints as nullability checks, check that phone number is 11 symbols, uniqueness of the subject name/phone number and range for the mark between 1 and 5 inclusively.

## Generating the mock data

We need to populate tables with huge amount of data for index analysis task. At the beginning I generated everything randomly with the [mock_data.sql](mock_data/mock_data.sql) script, but as I used md5 hash function my data did not look as the real world, so finally the https://www.mockaroo.com/ service was used to generate some fields as name, surname, full name of tutor, subject name (as movie title because Mockaroo does not have it) and primary skill as linkedin skill. The final CSV was generated by randomly getting data from Mockaroo CSV and  other fields randomly generated with the python script [mock_data.py](mock_data/mock_data.py).

## Index analysis

Let's check index sizes right after feeeding the data before creating any custom index. We can use the following command to check it:

```sql
select indexrelname "Index name", pg_size_pretty(pg_relation_size(indexrelid)) "Index size", amname "Index type"
from pg_stat_all_indexes sai
join pg_class c ON sai.indexrelid=c.oid
join pg_am am ON c.relam=am.oid
where sai.relname in ('students', 'subjects', 'exam_results')
```

We can see postgress created indexes for primary keys and unique columns with btree type:

|"Index name"|"Index size"|"Index type"|
|---|---|---|
|"students_pkey"|"2208 kB"|"btree"|
|"students_phone_number_key"|"4360 kB"|"btree"|
|"subjects_pkey"|"40 kB"|"btree"|
|"subjects_subject_name_key"|"88 kB"|"btree"|